(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{1441:(e,t,s)=>{Promise.resolve().then(s.bind(s,7161))},7161:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(5155),r=s(2115),l=s(8070);function n(){let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(new Set),[i,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),[x,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(null),[f,g]=(0,r.useState)(!1),[u,b]=(0,r.useState)("all"),[w,j]=(0,r.useState)(null),[y,N]=(0,r.useState)(""),[k,v]=(0,r.useState)("id"),[C,E]=(0,r.useState)("desc"),[S,z]=(0,r.useState)([]);(0,r.useEffect)(()=>{A()},[u]);let A=async()=>{try{let e=(0,l.e)("ratings"),s=await fetch(e);if(s.ok){let e=await s.json();console.log("Fetched ratings:",e);let a=e.map(e=>e.zipcode).filter(e=>e&&""!==e.trim()).filter((e,t,s)=>s.indexOf(e)===t).sort();z(a);let r=e.map(e=>({...e,confirmed:void 0!==e.confirmed?e.confirmed:0})),l=r;"confirmed"===u?l=r.filter(e=>"number"==typeof e.confirmed?1===e.confirmed:"boolean"==typeof e.confirmed&&!0===e.confirmed):"unconfirmed"===u&&(l=r.filter(e=>"number"==typeof e.confirmed?1!==e.confirmed:"boolean"!=typeof e.confirmed||!0!==e.confirmed)),t(l)}else try{let e=await s.json();m(e.error||"Failed to fetch ratings")}catch(e){m("Failed to fetch ratings")}}catch(e){console.error("Error fetching ratings:",e),m(e instanceof Error?e.message:"Failed to fetch ratings")}},D=e=>{console.log("Toggling selection for ID:",e);let t=new Set(s);t.has(e)?t.delete(e):t.add(e),n(t)},F=async()=>{if(0===s.size){alert("Please select items to delete");return}if(window.confirm("Are you sure you want to delete ".concat(s.size," rating(s)?"))){c(!0),m(null),h(null);try{console.log("Attempting to delete IDs:",Array.from(s));let e=Array.from(s).map(async e=>{let t;let s=await fetch((0,l.e)("ratings/".concat(e)),{method:"DELETE"});try{t=await s.json()}catch(e){t={}}if(!s.ok)throw Error("Failed to delete rating ".concat(e,": ").concat(t.error||s.statusText||"Unknown error"));return e}),a=await Promise.all(e);console.log("Successfully deleted ratings with IDs:",a),t(e=>e.filter(e=>!s.has(e.id))),h("Successfully deleted ".concat(s.size," rating(s)")),n(new Set)}catch(e){console.error("Error deleting ratings:",e),m(e instanceof Error?e.message:"Failed to delete ratings")}finally{c(!1)}}},T=e=>{j(e)},P=e=>new Date(e).toLocaleString(),U=(e,t)=>e?(0,a.jsx)("span",{className:"px-2 py-1 mr-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800",children:t}):null,I=async s=>{if(window.confirm("Are you sure you want to delete this rating?"))try{let a;g(!0);let r=await fetch((0,l.e)("ratings/".concat(s)),{method:"DELETE",headers:{"Content-Type":"application/json"}});try{a=await r.json()}catch(e){a={}}if(!r.ok)throw Error("Failed to delete rating: ".concat(a.error||r.statusText||"Unknown error"));t(e.filter(e=>e.id!==s)),h("Rating deleted successfully")}catch(e){console.error("Error deleting rating:",e),m(e instanceof Error?e.message:"Failed to delete rating")}finally{g(!1)}},R=async e=>{try{m(null),h(null),console.log("Using API for confirmation");let s=await fetch((0,l.e)("ratings/".concat(e,"/confirm")),{method:"PUT"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to confirm rating")}t(t=>t.map(t=>t.id===e?{...t,confirmed:1}:t)),h("Rating #".concat(e," marked as confirmed"))}catch(e){console.error("Error confirming rating:",e),m(e instanceof Error?e.message:"Failed to confirm rating")}},L=async()=>{if(0===s.size){alert("Please select items to confirm");return}d(!0),m(null),h(null);try{console.log("Using API for bulk confirmation");let e=await fetch((0,l.e)("ratings/confirm-bulk"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:Array.from(s)})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to confirm ratings")}t(e=>e.map(e=>s.has(e.id)?{...e,confirmed:1}:e)),h("Marked ".concat(s.size," rating(s) as confirmed")),n(new Set)}catch(e){console.error("Error confirming ratings:",e),m(e instanceof Error?e.message:"Failed to confirm ratings")}finally{d(!1)}},O=e=>{b(e)},_=e=>{N(e)},V=e=>{k===e?E("asc"===C?"desc":"asc"):(v(e),E("asc"))},B=e.filter(e=>!y||e.zipcode&&e.zipcode.toLowerCase().includes(y.toLowerCase())).sort((e,t)=>{let s=e[k],a=t[k];if(void 0===s||void 0===a)return 0;if("string"==typeof s&&"string"==typeof a)return"asc"===C?s.localeCompare(a):a.localeCompare(s);if("number"==typeof s&&"number"==typeof a)return"asc"===C?s-a:a-s;if(s&&a&&"string"==typeof s&&"string"==typeof a&&!isNaN(new Date(s).getTime())&&!isNaN(new Date(a).getTime())){let e=new Date(s).getTime(),t=new Date(a).getTime();return"asc"===C?e-t:t-e}return 0}),W=e=>k!==e?null:"asc"===C?" ↑":" ↓";return(0,a.jsxs)("div",{className:"max-w-full px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-black mb-8",children:"Admin Dashboard"}),x&&(0,a.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,a.jsx)("strong",{className:"font-bold",children:"Error: "}),(0,a.jsx)("span",{children:x})]}),p&&(0,a.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[(0,a.jsx)("strong",{className:"font-bold",children:"Success: "}),(0,a.jsx)("span",{children:p})]}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("button",{onClick:F,disabled:0===s.size||i,className:"px-3 py-1 text-sm rounded ".concat(0===s.size||i?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"),children:i?"Deleting...":"Delete (".concat(s.size,")")}),(0,a.jsx)("button",{onClick:L,disabled:0===s.size||o,className:"px-3 py-1 text-sm rounded ".concat(0===s.size||o?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:o?"Confirming...":"Confirm (".concat(s.size,")")})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-black",children:"Status:"}),(0,a.jsxs)("select",{value:u,onChange:e=>O(e.target.value),className:"px-2 py-1 rounded-md border border-gray-300 text-xs text-black bg-white",children:[(0,a.jsx)("option",{value:"all",children:"All"}),(0,a.jsx)("option",{value:"confirmed",children:"Confirmed"}),(0,a.jsx)("option",{value:"unconfirmed",children:"Unconfirmed"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-xs text-black",children:"Zip:"}),(0,a.jsxs)("select",{value:y,onChange:e=>_(e.target.value),className:"px-2 py-1 rounded-md border border-gray-300 text-xs text-black bg-white w-24",children:[(0,a.jsx)("option",{value:"",children:"All"}),S.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("span",{className:"text-xs text-black",children:[B.length," found"]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto bg-white shadow-md rounded-lg",children:(0,a.jsxs)("table",{className:"w-full table-auto divide-y divide-gray-200 text-xs",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-8",children:(0,a.jsx)("input",{type:"checkbox",checked:s.size>0&&s.size===B.length,onChange:()=>{if(s.size===e.length)n(new Set);else{let t=new Set(e.map(e=>e.id));console.log("Selected all IDs:",Array.from(t)),n(t)}},className:"h-3 w-3 text-blue-600 border-gray-300 rounded"})}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-10 cursor-pointer hover:bg-gray-100",onClick:()=>V("id"),children:["ID",W("id")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-24 cursor-pointer hover:bg-gray-100",onClick:()=>V("reviewerName"),children:["User",W("reviewerName")]}),(0,a.jsx)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-10",children:"Emoji"}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-32 cursor-pointer hover:bg-gray-100",onClick:()=>V("restaurantName"),children:["Restaurant",W("restaurantName")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-32 cursor-pointer hover:bg-gray-100",onClick:()=>V("burritoTitle"),children:["Burrito",W("burritoTitle")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-20 cursor-pointer hover:bg-gray-100",onClick:()=>V("rating"),children:["Rating",W("rating")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-24 cursor-pointer hover:bg-gray-100",onClick:()=>V("createdAt"),children:["Date",W("createdAt")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-24 cursor-pointer hover:bg-gray-100",onClick:()=>V("confirmed"),children:["Status",W("confirmed")]}),(0,a.jsxs)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-16 cursor-pointer hover:bg-gray-100",onClick:()=>V("zipcode"),children:["Zip",W("zipcode")]}),(0,a.jsx)("th",{scope:"col",className:"px-2 py-2 text-left text-xs font-medium text-black uppercase tracking-wider w-24",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:B.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap",children:(0,a.jsx)("input",{type:"checkbox",checked:s.has(e.id),onChange:()=>D(e.id),className:"h-3 w-3 text-blue-600 border-gray-300 rounded"})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black",children:e.id}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black truncate max-w-[6rem]",children:e.reviewerName||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-center",children:e.reviewerEmoji||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black truncate max-w-[8rem]",children:e.restaurantName}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black truncate max-w-[8rem]",children:e.burritoTitle}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-xs text-black",children:e.rating.toFixed(1)}),(0,a.jsxs)("span",{className:"ml-1 text-xs text-black",children:["(",e.taste.toFixed(1),"/",e.value.toFixed(1),")"]})]})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black",children:P(e.createdAt).split(" ")[0]}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap",children:e.confirmed?(0,a.jsx)("span",{className:"px-1 py-0.5 inline-flex text-xs leading-4 font-semibold rounded-full bg-green-100 text-green-800",children:"Confirmed"}):(0,a.jsx)("span",{className:"px-1 py-0.5 inline-flex text-xs leading-4 font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Pending"})}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs text-black",children:e.zipcode||"-"}),(0,a.jsx)("td",{className:"px-2 py-2 whitespace-nowrap text-xs font-medium",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("button",{onClick:()=>T(e),className:"text-blue-600 hover:text-blue-900 text-xs",children:"View"}),(0,a.jsx)("button",{onClick:()=>I(e.id),className:"text-red-600 hover:text-red-900 text-xs",children:"Del"}),!e.confirmed&&(0,a.jsx)("button",{onClick:()=>R(e.id),className:"text-green-600 hover:text-green-900 text-xs",children:"Confirm"})]})})]},e.id))})]})}),w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-black",children:"Rating Details"}),(0,a.jsx)("button",{onClick:()=>j(null),className:"text-black hover:text-gray-700",children:"✕"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-black mb-2",children:w.restaurantName}),(0,a.jsx)("p",{className:"text-black",children:w.burritoTitle}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-black mr-2",children:"Overall:"}),(0,a.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:[w.rating.toFixed(1),"/5"]})]}),(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-black mr-2",children:"Taste:"}),(0,a.jsxs)("span",{children:[w.taste.toFixed(1),"/5"]})]}),(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-black mr-2",children:"Value:"}),(0,a.jsxs)("span",{className:"text-black",children:[w.value.toFixed(1),"/5"]})]}),(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("span",{className:"font-semibold text-black mr-2",children:"Price:"}),(0,a.jsxs)("span",{className:"text-black",children:["$",w.price.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"font-semibold text-black block mb-1",children:"Reviewer:"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-black",children:w.reviewerName||"Anonymous"}),w.reviewerEmoji&&(0,a.jsx)("span",{className:"ml-2 text-2xl",children:w.reviewerEmoji})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"font-semibold text-black block mb-1",children:"Date:"}),(0,a.jsx)("span",{className:"text-black",children:P(w.createdAt)})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"font-semibold text-black block mb-1",children:"Status:"}),w.confirmed?(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Confirmed"}):(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Unconfirmed"})]})]})]}),w.review&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"font-semibold text-black block mb-1",children:"Review:"}),(0,a.jsx)("p",{className:"text-black bg-gray-50 p-3 rounded",children:w.review})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("span",{className:"font-semibold text-black block mb-2",children:"Ingredients:"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[U(w.hasPotatoes,"Potatoes"),U(w.hasCheese,"Cheese"),U(w.hasBacon,"Bacon"),U(w.hasChorizo,"Chorizo"),U(w.hasAvocado,"Avocado"),U(w.hasVegetables,"Vegetables")]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 mt-6",children:[(0,a.jsx)("button",{onClick:()=>j(null),className:"px-4 py-2 bg-gray-200 text-black rounded hover:bg-gray-300",children:"Close"}),(0,a.jsx)("button",{onClick:()=>{I(w.id),j(null)},className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"}),!w.confirmed&&(0,a.jsx)("button",{onClick:()=>{R(w.id),j(null)},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Confirm"})]})]})})})]})}},8070:(e,t,s)=>{"use strict";s.d(t,{e:()=>a});let a=e=>{let t="https://your-worker-name.your-account.workers.dev";console.log("Using API base URL: ".concat(t));let s=e;return e.startsWith("/api/")||e.startsWith("api/")?e.startsWith("/")&&(s=e.substring(1)):s="api/".concat(e),"".concat(t,"/").concat(s)}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(1441)),_N_E=e.O()}]);